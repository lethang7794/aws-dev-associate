# Tutorial Dojo - DVA-C02 - Summary

## Domain 1: Development with AWS Services

| No    |     | Q                                                                                                                      | A                                                                                                                                                 | Ref                                                 |
| ----- | --- | ---------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------- |
|       |     |                                                                                                                        |                                                                                                                                                   |                                                     |
| I.1   | ✅  | Improve performance of S3 upload                                                                                       | Multipart upload                                                                                                                                  |                                                     |
| I.2   | ✅  | Caching: Lazy-load & Write-through                                                                                     |                                                                                                                                                   |                                                     |
| I.3   | ✅  | Lambda: Different parameter depends on environment                                                                     | Environment variable (# Stage variable)                                                                                                           |                                                     |
| I.5   | ✅  | API Gateway: same API Gateway for multiple environments                                                                | Stage variable                                                                                                                                    |                                                     |
| I.6   | ✅  | CloudWatch Alarm: When to alarm?                                                                                       | `Period` / `Evaluation Periods` / `Data points to Alarm`                                                                                          |                                                     |
| I.7   | ✅  | SAM: Nested application                                                                                                | `AWS::Serverless::Application`                                                                                                                    |                                                     |
| I.8   | ✅  | Lambda deploy: Graduate increase traffic to new version                                                                | Lambda supports traffic shifting for aliases (by setting `traffic weight`). (That's why SAM have `canary`, `linear` deployment strategy )         |                                                     |
| I.9   | ✅  | API Gateway: Map data for microservice (in container)                                                                  | Use `HTTP` integration (Not `AWS` or `_PROXY`)                                                                                                    |                                                     |
| I.10  | ✅  | Database scale globally, handle frequent schema changes                                                                | DynamoDB (not Aurora)                                                                                                                             |                                                     |
| I.11  | ✅  | API Gateway - TTL 300s. How client can invalidate cache?                                                               | Send request with `Cache-Control: max-age=0` header                                                                                               |                                                     |
| I.13  | ✅  | Session data store on DynamoDB. Delete session of logged out users?                                                    | Use DynamoDB TTL (when will an item is eligible for expiration - in epoch time)                                                                   |                                                     |
| I.15  | ✅  | Serve content based on location                                                                                        | - CloudFront can add header about viewer location's location (based on the viewer's IP address).                                                  |                                                     |
| I.16  | ✅  | What to do after update Cfn template of a Lambda function?                                                             | 1. `aws cloudformation package`: Uploads local artifacts to S3, update Cfn template to reference these artifacts                                  |                                                     |
| I.17  | ✅  | Multi-thread key-value cache store                                                                                     | Elasticache for Memcached                                                                                                                         |                                                     |
| I.19  | ✅  | Process long-running tasks                                                                                             | Elastic Beanstalk worker environment (an HTTP request handler that EB invokes with an SQS queue)                                                  |                                                     |
| I.20  | ✅  | ECS: Where to config port for container?                                                                               | Task definition                                                                                                                                   |                                                     |
| I.22  | ✅  | Can Lambda handle 10 requests/s (each request take 50s)                                                                | 500 concurrent execution (Lambda can handles without doing anything. The default limit is 1.000)                                                  |                                                     |
| I.23  | ✅  | DynamoDB table attributes: UserID (PK) - GameTitle (SK) - TopScore. Get max TopScore of each game?                     | Create a Global Secondary Index: GameTitle (PK) - TopScore (SK). Query 1 item for each game in descending order.                                  |                                                     |
| I.24  | ✅  | Kinesis Data Streams: How many worker is optimal to process a number of shards?                                        | 1:1 ratio                                                                                                                                         |                                                     |
| I.25  | ✅  | AWS CLI timeout when list bucket with 10.000 objects                                                                   | Add pagination parameter when use AWS CLI                                                                                                         |                                                     |
| I.26  | ✅  | Permission to Create/Delete GitCommit repos                                                                            | `codecommit:CreateRepository` & `codecommit:DeleteRepository`                                                                                     |                                                     |
| I.27  | ✅  | DynamoDB Streams: Send a copy of old item to S3                                                                        | `StreamViewType`: `OLD_IMAGE`                                                                                                                     |                                                     |
| II.1  | ✅  | RDS + Lambda + Translate text with Amazon Translate. Improve performance, reduce load to RDS?                          | Use Lambda execution environment `/tmp` as cache store                                                                                            |                                                     |
| II.2  | ✅  | DynamoDB: Employee info. Which attribute use as primary key?                                                           | employee_id                                                                                                                                       |                                                     |
| II.3  | ✅  | Run a Lambda function every 30min?                                                                                     | Use EventBridge `Schedule` Rule to create scheduled events -> target the Lambda function                                                          |                                                     |
| II.4  | ✅  | ECS integrate with API Gateway. Which integration make no intervention?                                                | HTTP_PROXY                                                                                                                                        |                                                     |
| II.5  | ✅  | Which API to call to get permission (from a IAM Role) to interact with S3 API                                          | AWS STS `AssumeRole` API (or `AssumeRoleWithWebIdentity`, `AssumeRoleWithSAML`) (optionally pass an `SessionPolicy`)                              |                                                     |
| II.6  | ✅  | Asynchronous invoke Lambda function with `Invoke` API                                                                  | Pass parameter `InvocationType` - `Event`                                                                                                         |                                                     |
| II.11 | ✅  | DynamoDB: Write heavy - `ProvisionedThroughputExceededException`. Why?                                                 | RCU/WCU of GSI is separate from base table                                                                                                        |                                                     |
| II.12 | ✅  | CodeCommit: Permission to `fetch`, `clone`, `push`                                                                     | `codecommit:GitPull`, `codecommit:GitPush`                                                                                                        |                                                     |
| II.13 | ✅  | Elastic Beanstalk: Deploy new version with CLI                                                                         | Package app as `zip`/`war` file. Deploy with `eb deploy` (EB CLI is a different package. It's not packaged with AWS CLI, not `aws eb`)            |                                                     |
| II.14 | ✅  | Internal app: elastic, cost-effective                                                                                  | DynamoDB, EC2 Spot Fleet                                                                                                                          |                                                     |
| II.15 | ✅  | Build an CI/CD to deploy to both EC2 & on-premise. Which service?                                                      | CodeDeploy                                                                                                                                        |                                                     |
| II.16 | ✅  | DynamoDB: 10 RCU, each item 4KB. How much read request/s the table can handle?                                         | 10 RCU: 10 Strong Consistency Read - 20 Eventually Consistency Read                                                                               |                                                     |
| II.17 | ✅  | Prototype microservices on ECS. Which task placement minimize cost?                                                    | **Binpack**, ~~random~~, ~~spread~~                                                                                                               |                                                     |
| II.18 | ✅  | Temporary AWS credential for both authenticated/unauthenticated. Which service?                                        | Cognito Identity Pool (Federated Identity)                                                                                                        |                                                     |
| II.20 | ✅  | SQS: Duplicated messages. How to fix?                                                                                  | For SQS, when call `SendMessage` API, add `MessageDeduplicationId` param                                                                          |                                                     |
| II.21 | ✅  | DynamoDB: Protect from overwritten?                                                                                    | Implement `optimistic locking` with version number (ensure update the right version item)                                                         | [Optimistic locking with version number - DynamoDB] |
| II.22 | ✅  | Lambda: Asynchronous invoke, exponential back-off, then send un-processed messages to another service.                 | Lambda supports Dead Letter Queue (just as SQS DLQ)                                                                                               |                                                     |
| II.23 | ✅  | Collect visitor click to ads. Which service?                                                                           | DynamoDB: Use `UpdateItem` to implement `atomic counter` (Approximately ~ Add 1 to previous value)                                                |                                                     |
| II.24 | ✅  | DynamoDB: Read 100 items. Which API?                                                                                   | `BatchGetItem` (instead of `GetItem`) then `BatchWriteItem`                                                                                       |                                                     |
| II.25 | ✅  | DynamoDB: Store recent updated item automatically                                                                      | 1. DynamoDB Streams + Lambda (not recommend)                                                                                                      |                                                     |
| II.26 | ✅  | DynamoDB: Session data. Reduce storage without using provision throughput                                              | Use DynamoDB TTL                                                                                                                                  |                                                     |
| II.27 | ✅  | Kinesis Data Streams: How to handle data flow (Scaling)?                                                               | 1. Split shards to increase stream capacity; 2. Merge shards to decrease stream capacity.                                                         |                                                     |
| II.28 | ✅  | Kinesis Data Streams: Consumer process every other day & store to S3. S3 only has half of the data?                    | Kinesis Data Streams default `retention period` is `24h` (max: 14 days)                                                                           |                                                     |
| II.29 | ✅  | An AWS account has 2 Lambda function. 1 works optimal, 1 is throttled. Why?                                            | The `reserve` `concurrency execution` of function 1 is higher                                                                                     |                                                     |
| II.30 | ✅  | Lambda: Process events from S3 Events. 10 events/s, each event takes 3s. How much concurrency?                         | Concurrency: number of in-flight request AWS Lambda function is handling at the same time.                                                        |                                                     |
| II.32 | ✅  | Protect AWS APIs call with MFA                                                                                         | MFA-enabled IAM users must call GetSessionToken and submit an MFA code that is associated with their MFA device.                                  |                                                     |
| II.34 | ✅  | Website hosted on S3 `bucket_A`, make GET request to S3 `bucket_B`. API calls are blocked by browsers?                 | Enable CORS on `bucket_B`                                                                                                                         |                                                     |
| II.35 | ✅  | Migrate repos from Github to CodeCommit                                                                                | 1. Create repos on CodeCommit; 2. Clone repos from Github; 3. Push to CodeCommit repos                                                            |                                                     |
| II.36 | ✅  | Lambda: Increase CPU?                                                                                                  | By increase memory                                                                                                                                |                                                     |
| II.37 | ✅  | ECS: Integrate with X-Ray. How to provide more granular timing information?                                            | Use sub-segment                                                                                                                                   |                                                     |
| II.38 | ✅  | Version control system. Which service?                                                                                 | CodeCommit                                                                                                                                        |                                                     |
| II.39 | ✅  | API Gateway: Non-proxy integration with Lambda. How to ensure consumer include a query string?                         | Use method request                                                                                                                                |                                                     |
| IV.1  | ✅  | Automatically watermark images uploaded to S3                                                                          | Use S3 Event Notification `s3:ObjectCreate:Put`. Send the event to Lambda function (destination)                                                  |                                                     |
| IV.2  | ✅  | Lambda function: access RDS in private subnet                                                                          | Connect to the VPC                                                                                                                                |                                                     |
| IV.3  | ✅  | API Gateway + Lambda: Map incoming request to integration request & vice versa                                         | AWS custom (Lambda custom)                                                                                                                        |                                                     |
| IV.4  | ✅  | Which cache strategy ensured cached data is always up-to-date & stale data are automatically deleted?                  | Write-through + With TTL                                                                                                                          | [1.4]                                               |
| IV.5  | ✅  | DynamoDD: How to prevent data overwritten?                                                                             | Optimistic locking + Conditional writes (check version number)                                                                                    |                                                     |
| IV.6  | ✅  | Database credential: How to encrypted & auto-rotate?                                                                   | Use Secrets Manager + Enable Automatic Rotation                                                                                                   |                                                     |
| IV.7  | ✅  | S3: Use SQL to filter & retrieve only a subset data of an object?                                                      | S3 Select (supports CSV, JSON, Apache Parquet & compressed CSV, JSON)                                                                             | [1.7]                                               |
| IV.9  | ✅  | DynamoDB - GSI: How much throughput to provision?                                                                      | GSI WCU >= Base table WCU                                                                                                                         |                                                     |
| IV.10 | ✅  | DynamoDB: 2KB items - 10 writes/s - 20 eventually consistent reads/s. How much RCU/WCU?                                | 2KB ➡️ 1 strongly consistent read = 1 RCU ➡️ 1 eventually = 0.5 RCU ➡️ 20 eventually = 10 RCU                                                     |                                                     |
| IV.11 | ✅  | 1 item = 17KB. 320 strongly consistent read/s. How much RCU?                                                           | 17KB/item ➡️ 5RCU/strongly consistent read ➡️ 320 strongly read = 320 x 5 = 1600 RCU                                                              |                                                     |
| IV.12 | ✅  | HTML, JS, image, video. How to server with lowest latency around the world?                                            | S3 + CloudFront                                                                                                                                   |                                                     |
| IV.13 | ✅  | AI-based app built with Lambda. How to modify the way invocation event are read form Lambda runtime API?               | Use Lambda custom runtime                                                                                                                         |                                                     |
| IV.14 | ✅  | Migrate monolith on-premise app to Lambda. Best practice?                                                              | 1. Take advantage of `execution runtime`; 2. Use environment variable...                                                                          | [1.14 Lambda Best Practice]                         |
| IV.16 | ✅  | Online game - Sync app pref + state of player + Allow multiple player to share state                                   | App Sync (Cognito Sync not support shared data)                                                                                                   |                                                     |
| IV.17 | ✅  | AWS CLI in EC2 instance. How to easily switch role?                                                                    | 1. Create a new CLI profile with credential; 2. Run `aws` CLI with `--profile`                                                                    |                                                     |
| IV.18 | ✅  | DynamoDB: Ensure item is updated only some attribute meets some condition                                              | Conditional writes                                                                                                                                |                                                     |
| IV.19 | ✅  | DynamoDB: Debug throughput of both base table & GSI when update item?                                                  | Call `UpdateItem` with `ReturnConsumedCapacity` set to ~~`None`~~ / ~~`Total`~~ / `Indexes`                                                       | [1.19 PutItem - ReturnConsumedCapacity]             |
| IV.20 | ✅  | DynamoDB Streams: How to integrate with Lambda?                                                                        | 1. Create an `EventSourceMapping` to poll the DynamoDB stream, read & process records                                                             |                                                     |
| IV.21 | ✅  | Serverless app: Which service can manage configuration & deploy the whole stack + simple?                              | AWS SAM (Serverless Application Model)                                                                                                            |                                                     |
| IV.22 | ✅  | DynamoDB: Table: ArticleName (PK) - Category (SK). Query ArticleName using another Sort Key + Strongly consistent read | Create a new table with Local Secondary Index (LSI). Migrate the existing data to new table (LSI cannot be created after the DynamoTB is created) |                                                     |
| IV.23 | ✅  | S3: Ensure all objects are encrypted with AE256                                                                        | Use **bucket policy** to deny any Create request doesn't have `x-amz-server-side-encryption: AE256` header                                        |                                                     |
| IV.24 | ✅  | EC2: Shell script to get instance public/private IP                                                                    | Use Instance Metadata Service endpoint 169.254.169.254/latest/meta-data                                                                           |                                                     |
| IV.25 | ✅  | Lambda: Account concurrency limit 2000; 10 functions: 1 function 400, 1 function 200. The rest, the third?             | The rest: 1400; the third: 1300.                                                                                                                  |                                                     |
| IV.26 | ✅  | Coordinate multiple services into serverless workflow. Which service?                                                  | AWS Step Functions                                                                                                                                |                                                     |
| IV.27 | ✅  | API Gateway: Enable caching. How to invalidate 1 key?                                                                  | Send the request with `Cache-Control: max-age=0`                                                                                                  |                                                     |
| IV.28 | ✅  | Lambda: Connection refused. Why?                                                                                       | Maybe the invoke URL is wrong (`http` without `s`)                                                                                                |                                                     |
| IV.29 | ✅  | Lambda: Improve performance?                                                                                           | Increase memory will increase CPU too.                                                                                                            |                                                     |
| IV.30 | ✅  | Lambda: A function initialize DB connection every time it executes. How to optimize?                                   | Move the DB connection to shared `execution context` (outside handler)                                                                            |                                                     |
| IV.31 | ✅  | Lambda: Can the function built with Rust?                                                                              | Yes. Use custom runtime                                                                                                                           |                                                     |
| IV.32 | ✅  | Lambda: A function fetch 20MB static data every time it executes. How to optimize?                                     | Place the initialize outside Lambda handler; saved external file to `/tmp`                                                                        |                                                     |
| IV.34 | ✅  | Online game. How to add feature to cross-sync profile data between device?                                             | Use Cognito Sync (or App Sync)                                                                                                                    |                                                     |
| IV.35 | ✅  | DynamoDB: Which attribute to use as partition key?                                                                     | The partition should uniquely identify each item                                                                                                  |                                                     |
| IV.36 | ✅  | CodePipeline: Push build details into a DynamoDB?                                                                      | Use EventBridge & Lambda                                                                                                                          |                                                     |
| V.2   | ✅  | API Gateway & Lambda: New version. Smooth migration                                                                    | Update Lambda function -> Deploy new version. Specify new ARN in API Gateway integration. Redeploy to new stage.                                  |                                                     |
| V.3   | ✅  | Elastic Beanstalk: Path of config file                                                                                 | /.ebextensions/xxx.config                                                                                                                         |                                                     |
| V.4   | ✅  | Lambda: Ephemeral storage                                                                                              | `/tmp`                                                                                                                                            |                                                     |
| V.5   | ✅  | Lambda: How to use Ruby?                                                                                               | Ruby's natively support                                                                                                                           |                                                     |
| V.6   | ✅  | CloudFront: Update image immediately                                                                                   | Use file name versioning                                                                                                                          |                                                     |
| V.7   | ✅  | Cognito: Authentication with JWT                                                                                       | 1. Create User Pools                                                                                                                              |                                                     |
| V.9   | ✅  | S3: Lowest cost                                                                                                        | Glacier Deep Archive                                                                                                                              |                                                     |
| V.10  | ✅  | EC2: Run Apache web server                                                                                             | Use user-data to install and start Apache web server                                                                                              |                                                     |
| V.11  | ✅  | App host in 1 region. Re-create on other regions using AMI & CloudFormation. How?                                      | Use Cfn Mapping & FindInMap                                                                                                                       |                                                     |
| V.12  | ✅  | Serverless app. Application code & infrastructure code in Python. How?                                                 | Use CDK and Python                                                                                                                                |                                                     |
| V.13  | ✅  | Step Functions: Handle error? Aggregate data in different states?                                                      | Use Catch & ResultPath                                                                                                                            |                                                     |
| V.15  | ✅  | DynamoDB: Control access to individual items & attributes?                                                             | Fine-grain access control with                                                                                                                    | [1.15]                                              |
| V.16  | ✅  | Cognito: UI for login page missing brand logo                                                                          | Cognito allows customization for: logo, CSS.                                                                                                      |                                                     |
| V.17  | ✅  | SQS queue: messages larger than 256KB.                                                                                 | Use Amazon S3, (for Java) Extended Client Library                                                                                                 |                                                     |
| V.20  | ✅  | API Gateway: Integrate a XML-based SOAP API. How?                                                                      | Use HTTP Integration:                                                                                                                             |                                                     |
| V.21  | ✅  | Serverless: Send newsletter at 7-day interval. How?                                                                    | Use `EventBridge` Schedule Rule to create events at 7-day interval, sends the events to `Lambda function` target                                  |                                                     |
| V.23  | ✅  | DynamoDB: Group multiple actions to multiple items to a one-or-nothing operation?                                      | Use `TransactionWriteItems`                                                                                                                       |                                                     |
| V.24  | ✅  | DynamoDB: When an item added to `Customer` table, dynamically update `Payment` table. How do it in real time?          | Enable DynamoDB Streams for `Customer` table, trigger a Lambda function to update `Payment` table                                                 |                                                     |
| V.25  | ✅  | ALB: Obtain all value of identical query parameter key.                                                                | Enable `multi-value headers`                                                                                                                      |                                                     |
| V.26  | ✅  | ECS: 2 containers share logs. How?                                                                                     | Define these 2 containers in 1 task definition, use EFS as a volume                                                                               |                                                     |

## Domain 2: Security

| No    |     | Q                                                                                      | A                                                                                                                                                                                       | Ref                                   |
| ----- | --- | -------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------- |
|       |     |                                                                                        |                                                                                                                                                                                         |                                       |
| I.2   | ✅  | Share DB endpoint                                                                      | Use System Manager Parameter Store secure string                                                                                                                                        |                                       |
| I.4   | ✅  | API Gateway: Allow another account invoke via IAM Role                                 | 1. From the other account, grant permission to interact with this API Gateway                                                                                                           | [Managing access to API Gateway]      |
| I.5   | ✅  | Grant permission to access only some path of a S3 bucket                               | Use S3 bucket policy, with the policy statement `Resource` including the path                                                                                                           |                                       |
| I.6   | ✅  | Login with social site: Facebook..., then access to AWS service                        | Cognito Identity Pool (Federated Identity)                                                                                                                                              |                                       |
| I.7   | ✅  | S3 - Encrypt AE256                                                                     | `x-amz-server-side-encryption: AE256`                                                                                                                                                   |                                       |
| I.9   | ✅  | KMS - Generate data key but not use immediately                                        | `GenerateDataKeyWithoutPlaintext`                                                                                                                                                       |                                       |
| II.1  | ✅  | Cognito - Enforce MFA for suspicious login attempt                                     | User Pool / **Adaptive Authentication** / Automatic risk response                                                                                                                       | [Adaptive Authentication - User Pool] |
| II.2  | ✅  | EC2 instance - Upload images to S3. How to give EC2 instance permission?               | IAM Role (Instance Profile)                                                                                                                                                             |                                       |
| II.3  | ✅  | Dev needs to access Test/Prod accounts. How to give permission?                        | Grant cross-account access:                                                                                                                                                             |                                       |
| II.4  | ✅  | API Gateway - Lambda Authorizer: Implement one that same as OAuth, SAML                | API Gateway - Lambda Authorizer (Custom Authorizer) has 2 types:                                                                                                                        |                                       |
| II.5  | ✅  | EC2 instance has both `credentials` & `Instance Profile`                               | AWS CLI credentials precedence: CLI options > ENVVAR > Assumed Role > IAM Identity (~/.aws/config) > Credential file (~/.aws/credentials) > EC2 instance profile > Container credential | [AWS CLI Credentials Precedence]      |
| II.8  | ✅  | S3 - Encryption using KMS-C. How to upload object?                                     | Include the headers: `x-amz-server-side​-encryption​-customer-` + `algorithm`/`key`/`key-MD5`                                                                                           |                                       |
| II.9  | ✅  | IAM, SCP - How to test IAM policy?                                                     | IAM Policy Simulator                                                                                                                                                                    |                                       |
| IV.2  | ✅  | SSM Parameter Store: Notify if param haven't been rotated for 90 days                  | 1. Use Advanced tier / Parameter polices / Notification policies                                                                                                                        |                                       |
| IV.3  | ✅  | S3: Ensure data is encrypted at rest using the company key                             | 1. Client-Side Encryption (CSE) - Encrypt the data before send to S3                                                                                                                    |                                       |
| IV.4  | ✅  | KMS: Locally encrypt data (Envelope encryption)                                        | 1. Use the `GenerateDataKey` API to get a `data key`.                                                                                                                                   |                                       |
| IV.5  | ✅  | API Gateway: Custom authorizer using bearer token (same as SAML, OAuth). How?          | Use API Gateway **Lambda authorizer** (aka custom authorizer)                                                                                                                           | [2.5]                                 |
| IV.6  | ✅  | Database credential + Rotate                                                           | Secrets Manager + Auto Rotation (How? Secrets Manager run a Lambda function )                                                                                                           | [2.6]                                 |
| IV.7  | ✅  | CloudFormation: Retrieve license key + cost-effective                                  | Systems Manager Parameter Store + Secure String                                                                                                                                         |                                       |
| IV.8  | ✅  | Migrate on-premise to AWS. Integrate LDAP directory service (not compatible with SAML) | Implement a _custom_ **identity broker**, which use `STS` to issue short-live AWS credentials                                                                                           | [2.8]                                 |
| IV.9  | ✅  | Cognito: Additional authentication method                                              | Integrate Multi-Factor Authentication (MFA) to Cognito User Pool                                                                                                                        |                                       |
| IV.10 | ✅  | SQL Server. Migrate to RDS. Encrypt data before write to disk & vice versa.            | Enable SQL Server Transparent Data Encryption                                                                                                                                           |                                       |
| IV.11 | ✅  | S3. Someone use your image without permission.                                         | (Block public access) Use pre-signed URL / pre-signed cookies                                                                                                                           |                                       |
| V.2   | ✅  | S3 bucket in production account. How to allow a user on dev account access?            | 1. In `prod` acc, create an IAM role                                                                                                                                                    | [2.2]                                 |
| V.3   | ✅  | S3. Which service to allow user register/sign-in & upload/access images on S3.         | Cognito User Pools & Identity Pools                                                                                                                                                     |                                       |
| V.4   | ✅  | Allow temporary access to EC2 & but still enforce MFA? Which STS API?                  | STS `GetSessionToken`                                                                                                                                                                   |                                       |
| V.6   | ✅  | API Gateway: Regulate access to API & charge based on usage                            | Usage Plan                                                                                                                                                                              |                                       |
| V.7   | ✅  | Best practice to manage access key                                                     | Remote all access key of root account, use IAM role for applications                                                                                                                    |                                       |
| V.8   | ✅  | Most secure way to send CW logs in EC2 instance of ASG launch configuration            | - Create a new IAM role for the new Launch Configuration                                                                                                                                |                                       |
| V.10  | ✅  | S3: Hundreds of thousands of objects. Turn on SSE-KMS. Performance degradation. Why?   | Requests to KMS are exceeded quota                                                                                                                                                      |                                       |
| V.11  | ✅  | How to check permission of an IAM role?                                                | 1. Use IAM Policy Simulator                                                                                                                                                             |                                       |

## Domain 3: Deployment

| No   |     | Q                                                                                                          | A                                                                                                    | Ref                                             |
| ---- | --- | ---------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | ----------------------------------------------- |
|      |     |                                                                                                            |                                                                                                      |                                                 |
| I.3  | ✅  | Deploy Lambda with CodeDeploy                                                                              | CodeDeploy deploy configuration:                                                                     |                                                 |
| I.4  | ✅  | Build, test, deploy serverless app                                                                         | Serverless Application Model (SAM)                                                                   |                                                 |
| II.1 | ✅  | SAM: workflow redeploy                                                                                     | 1. `sam build`; 2. `sam deploy`                                                                      |                                                 |
| II.2 | ✅  | Elastic Beanstalk: Dev/Test - Deploy ASAP                                                                  | EB deployment strategy: `AllAtOnce`                                                                  |                                                 |
| II.3 | ✅  | SAM: deploy 10% every 10min                                                                                | SAM `Linear` `10min`                                                                                 |                                                 |
| II.4 | ✅  | Lambda: `package deployment` take too much time to deploy? How increase deploy speed?                      | Lambda package deployment quota (for a function) is 50 MB (zipped; includes runtimes, layer...)      |                                                 |
| II.6 | ✅  | CloudFormation: Easiest way to deploy a `hello_world` lambda function                                      | Incline the function in `AWS::Lambda::Function` `Properties / Code / Zipfile`                        |                                                 |
| II.7 | ✅  | Elastic Beanstalk: Upgrade from Java 7 to 8. Shift all traffic to the new one, revert if something's wrong | Blue/Green Deployment: EB AllAtOnce + EB swap environment URLs (EB will use Route 53 to swap CNAMEs) | [Blue/Green deployments with Elastic Beanstalk] |
| II.8 | ✅  | CodeDeploy: Deploy to where? How?                                                                          | CodeDeploy deploy configuration:                                                                     |                                                 |
| IV.2 | ✅  | Elastic Beanstalk: HA, revert quickly?                                                                     | 1. Use any EB deployment strategy, e.g. All-at-once (fastest)                                        |                                                 |
| IV.3 | ✅  | CloudFormation: Inline code in template                                                                    | `AWS::Lambda::Function` / `Code` / `ZipFile`                                                         |                                                 |
| IV.4 | ✅  | Serverless app: Zip code, upload to S3, produce package deployment-ready template & deploy                 | `sam deploy` (which includes `sam package`)                                                          |                                                 |
| IV.5 | ✅  | CloudFormation: Install packages, start services on EC2 after provisioned                                  | `cfn-init`                                                                                           |                                                 |
| V.1  | ✅  | CodeDeploy: S3 source. Deploy to EC2 fail during `DownloadBundle`                                          | The EC2 instance profile don't have permission to access S3 bucket                                   |                                                 |
| V.3  | ✅  | Deploy to 3 environments: `test`, `staging`, `production`. How?                                            | Use 3 `deployment group`s, each for 1 environment.                                                   |                                                 |
| V.4  | ✅  | Elastic Beanstalk: Multi-container Docker. Which file to configure container definitions?                  | `Dockerrun.aws.json`                                                                                 |                                                 |
| V.5  | ✅  | Elastic Beanstalk: Multi developers deploy without upload the whole project?                               | Use `eb deploy` to deploy from local `CodeCommit` repo                                               |                                                 |
| V.6  | ✅  | Serverless app defined with CDK. Deploy to new account. `NoSuchBucket` error. Fix?                         | Run `cdk bootstrap` to provision resources for CDK deployment, e.g. IAM role, S3 bucket.             |                                                 |
| V.8  | ✅  | CodeCommit: Forgot to pull master. Fix conflict?                                                           | `git rebase` `feature` branch on `master` branch. Then manually fix conflict.                        |                                                 |

## Domain 4: Troubleshooting and Optimization

| No    |     | Q                                                                                                                              | A                                                                                          | Ref                          |
| ----- | --- | ------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------ | ---------------------------- |
|       |     |                                                                                                                                |                                                                                            |                              |
| I.1   | ✅  | Move session data to AWS, 100% CPU, HA                                                                                         | ElastiCache for Redis                                                                      |                              |
| I.2   | ✅  | sam local - Access denied                                                                                                      | 1. `aws configure --profile`; 2. `sam local invoke --profile`                              |                              |
| I.3   | ✅  | Cost effective when using SQS                                                                                                  | Long polling (config `ReceiveMessage` `WaitTime`)                                          |                              |
| I.4   | ✅  | Record all changes to a DynamoDB table to another one                                                                          | DynamoDB Streams + Lambda (write to another DynamoDB table)                                |                              |
| I.5   | ✅  | DynamoDB - Reduce queries                                                                                                      | DAX                                                                                        |                              |
| I.8   | ✅  | ECS store data in DynamoDB, how to verify each new items?                                                                      | DynamoDB Streams + Lambda                                                                  |                              |
| I.9   | ✅  | API Gateway - 504                                                                                                              | 504 Gateway timeout -> Integration timeout after 30s                                       |                              |
| I.10  | ✅  | RDS - Too many connections                                                                                                     | RDS Proxy                                                                                  |                              |
| I.11  | ✅  | API Gateway timeout - Which CW metrics to watch?                                                                               | `Latency`, `IntegrationLatency`                                                            |                              |
| I.13  | ✅  | CloudFront - end-to-end SSL                                                                                                    | Viewer Protocol Policy, Origin Protocol Policy: HTTPS                                      |                              |
| I.15  | ✅  | Capture IP in/out of an VPC                                                                                                    | VPC Flow Log                                                                               |                              |
| I.16  | ✅  | Elastic Beanstalk config for cron-job                                                                                          | `cron.yaml`                                                                                |                              |
| I.17  | ✅  | DynamoDB - Fetch only some attributes                                                                                          | Use projection attributes                                                                  |                              |
| I.18  | ✅  | Lambda function download same big file                                                                                         | Use `/tmp`                                                                                 |                              |
| I.21  | ✅  | App deploy with Elastic Beanstalk - Config X-Ray                                                                               | `.ebextensions/xray-daemon.config`                                                         |                              |
| II.1  | ✅  | DynamoDB: ProvisionedThroughputExceeded                                                                                        | Optimize DynamoDB:                                                                         |                              |
| II.2  | ✅  | X-Ray: View full trace without using console                                                                                   | Use `GetTraceSummaries`, `BatchGetTraces`                                                  |                              |
| II.3  | ✅  | ECS + Docker app: How to setup tracing with X-Ray?                                                                             | - Run `xray-daemon` inside docker image                                                    | [AWS X-Ray daemon]           |
| II.4  | ✅  | AWS CLI - Timeout                                                                                                              | Use pagination: `--page-size` (request less items) `--max-items` (show less items)         | [AWS CLI pagination options] |
| II.9  | ✅  | X-Ray: From where, IP address is fetch?                                                                                        | `X-Forwarded-For` header                                                                   |                              |
| IV.1  | ✅  | Send traces to X-ray?                                                                                                          | Use X-Ray daemon (CloudWatch Agent can do this on EC2/On-Premise)                          |                              |
| IV.2  | ✅  | SQS: Duplicate message. Fix?                                                                                                   | Use FIFO queue + provide deduplicationID                                                   |                              |
| IV.3  | ✅  | X-Ray: Filter trace?                                                                                                           | 1. Use web console; 2. Use `GetTraceSummaries` (support search)                            |                              |
| IV.4  | ✅  | X-Ray: Send trace to X-Ray?                                                                                                    | - 1. Use X-Ray SDK (through X-Ray daemon); 2. Use X-Ray/CLI (directly)                     |                              |
| IV.5  | ✅  | Kinesis: Over-provision. Scale in?                                                                                             | Merge **cold** shards                                                                      |                              |
| IV.6  | ✅  | API Gateway: Terminated Lambda. Why?                                                                                           | - Lambda timeout: max `15min` ➡️ `terminated`                                              |                              |
| IV.7  | ✅  | API Gateway: No metrics for CacheHitCount/CacheMissCount                                                                       | API Gateway caching is not enabled                                                         |                              |
| IV.8  | ✅  | SQS injections, XSS attack. How to deal?                                                                                       | Use Web Application Firewall (WAF). It works with: CloudFront, ALB, API Gateway (REST API) |                              |
| IV.9  | ✅  | Kinesis: 10 shards - 10 EC2 instance. Increase to 20 shards, how many instances?                                               | 20 instances, the number of instances match the number of shards by `1:1` ratio            |                              |
| IV.10 | ✅  | RDS: Monitor memory, CPU usages of processes?                                                                                  | Use RDS enhanced monitoring                                                                |                              |
| IV.11 | ✅  | CodePipeline: Code review in each stage before move to next stage                                                              | Use a "manually approval" action, and send the approval request to a SNS topic             |                              |
| IV.12 | ✅  | X-Ray: Record call to DB, other services, SQL queries & filter                                                                 | Add **annotations** in the **subsegment** section of the **segment document**.             |                              |
| IV.13 | ✅  | X-Ray: Permission to send trace to X-Ray?                                                                                      | `AWSXRayDaemonWriteAccess`                                                                 |                              |
| V.3   | ✅  | CodeBuild: Run on a proxy server. `RequestError` when CodeBuild is accessed. Fix?                                              |                                                                                            |                              |
| V.5   | ✅  | S3 - Event Notifications: Compress the images, but it takes too much time. Improve?                                            | Increase memory ➡️ increase CPU                                                            |                              |
| V.6   | ✅  | Debug latency of your app (with recently added function)? How to do with X-Ray?                                                | Define sug-segments inside the function to "instrument" (measure) it                       |                              |
| V.7   | ✅  | AWS CLI: Create snapshot of EC2 instance. `InvalidInstanceID.NotFound`. Why?                                                   | Maybe the AWS CLI is using a profile for a different region                                |                              |
| V.8   | ✅  | Build a CI pipeline. Which AWS services?                                                                                       | CodeCommit, Lambda, CodeBuild                                                              |                              |
| V.9   | ✅  | Step Functions: Handle & recover from State's exception.                                                                       | Use `Catch` & `Retry` fields in state machine definition                                   |                              |
| V.10  | ✅  | Lambda - Cold start: Optimize?                                                                                                 | 1. Reduce pre-handler code                                                                 |                              |
| V.11  | ✅  | LAMP stack. Migrate to AWS?                                                                                                    | EC2 + Aurora/RDS                                                                           |                              |
| V.12  | ✅  | Lambda: process file (5min). So slow?                                                                                          | Change `InvokeType` to `Event` (asynchronous invocation)                                   |                              |
| V.14  | ✅  | Website (hosted on S3) call API Gateway. `No "Access-Control-Allow-Origin"` error. Fix?                                        | Config CORS for API Gateway to allow the website (S3)                                      |                              |
| V.15  | ✅  | API Gateway + Lambda: Publish a new version of `AccService:Prod` with the alias `AccService:Beta`. How to test before promote? | Create a `BETA` stage. Use stage variable to reference the `beta` function alias           |                              |
| V.16  | ✅  | Lambda: `Unable to import module`. Fix?                                                                                        | 1. Install the missing module locally.                                                     |                              |
| V.17  | ✅  | Elastic Beanstalk: Keep the old code in S3 bucket. How?                                                                        | Change `Retention` to `Retain source bundle in S3`                                         |                              |
